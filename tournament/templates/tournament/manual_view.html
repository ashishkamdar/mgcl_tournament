{% extends "tournament/base.html" %}
{% load tournament_extras %}

{% block header %}{% endblock %}

{% block content %}
<meta http-equiv="refresh" content="20">

<div class="container-fluid px-2" style="margin-top: 15px; margin-bottom: 110px;">
    
    <div class="text-start mb-3 ps-1">
        <div class="d-flex align-items-center">
            <img src="/media/event_logos/MGCL-logo.png" alt="MGCL" style="height: 45px; width: auto; margin-right: 12px;">
            <div>
                <h4 class="text-white fw-bold m-0 p-0" style="letter-spacing: 1px; font-size: 1.4rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                    CHAMPIONSHIP STANDINGS
                </h4>
                <div class="text-info opacity-75 fw-bold" style="font-size: 0.7rem; margin-top: 2px;">
                    LIVE UPDATES - AUTO REFRESHING
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive shadow-lg border border-secondary rounded" style="overflow-x: hidden !important;">
        <table class="table table-dark table-bordered table-sm align-middle mb-0" style="width: 100%; table-layout: auto;">
            <thead class="table-header-glass text-white">
                <tr>
                    <th style="width: 40px; text-align: left !important;" class="ps-2 border-bottom-0 border-end border-secondary">ID</th>
                    <th style="text-align: left !important; padding-left: 8px !important; font-size: 0.75rem;" class="border-bottom-0">Tournament Event</th>
                    
                    {% for team in teams %}
                    <th colspan="2" class="border-start border-light-subtle p-0" style="height: 80px; text-align: center !important;">
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="flex-shrink-0">
                                {% if team.name == "Golden Eagles" %}
                                    <img src="/media/team_icons/Golden_Eagles-removebg-preview.png" class="header-logo">
                                {% elif team.name == "Rising Phoenix" %}
                                    <img src="/media/team_icons/Rising_Phoenix-removebg-preview.png" class="header-logo">
                                {% elif team.name == "Flying Phantoms" %}
                                    <img src="/media/team_icons/Flying_Phantoms-removebg-preview.png" class="header-logo">
                                {% elif team.name == "Royal Warriors" %}
                                    <img src="/media/team_icons/Royal_Warriors-removebg-preview.png" class="header-logo">
                                {% elif team.name == "Mighty Titans" %}
                                    <img src="/media/team_icons/Mighty_Titans-removebg-preview.png" class="header-logo">
                                {% elif team.name == "Super Rangers" %}
                                    <img src="/media/team_icons/Super_Rangers-removebg-preview.png" class="header-logo">
                                {% else %}
                                    <i class="fas fa-shield-alt text-secondary opacity-50" style="font-size: 22px;"></i>
                                {% endif %}
                            </div>
                            <div class="ms-1 text-start lh-1 fw-bold team-label">
                                {{ team.name|upper }}
                            </div>
                        </div>
                    </th>
                    {% endfor %}
                </tr>
                <tr class="small text-center header-sub-row">
                    <th class="border-top-0 border-end border-secondary"></th>
                    <th class="border-top-0"></th>
                    {% for team in teams %}
                    <th class="border-start border-light-subtle py-1" style="text-align: center !important; font-size: 0.7rem;">P</th>
                    <th class="py-1" style="text-align: center !important; font-size: 0.7rem;">Pts</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for res in results %}
                <tr class="championship-row">
                    <td class="ps-2 text-info small fw-bold border-end border-secondary" style="text-align: left !important;">{{ res.event_id }}</td>
                    <td class="fw-bold ps-2 text-nowrap" style="text-align: left !important; font-size: 0.75rem; padding-right: 10px !important;">
                        {% if res.event_id == 1 %}Badminton (Singles) 1
                        {% elif res.event_id == 2 %}Badminton (Singles) 2
                        {% elif res.event_id == 3 %}Bridge
                        {% elif res.event_id == 4 %}Pickleball
                        {% elif res.event_id == 5 %}Snooker (Singles)
                        {% elif res.event_id == 6 %}Snooker (Doubles)
                        {% elif res.event_id == 7 %}Squash 1
                        {% elif res.event_id == 8 %}Squash 2
                        {% elif res.event_id == 9 %}Swimming (Men)
                        {% elif res.event_id == 10 %}Swimming (Women) 1
                        {% elif res.event_id == 11 %}Swimming (Women) 2
                        {% elif res.event_id == 12 %}Table Tennis (Doubles Men)
                        {% elif res.event_id == 13 %}Table Tennis (Singles Men)
                        {% elif res.event_id == 14 %}Table Tennis (Singles Women)
                        {% elif res.event_id == 15 %}Tennis (Singles)
                        {% elif res.event_id == 16 %}Tennis (Doubles) 1
                        {% elif res.event_id == 17 %}Tennis (Doubles) 2
                        {% else %}{{ res.event_name }}{% endif %}
                    </td>
                    {% for team in teams %}
                    {% with team_data=res.results_data|get_item:team.code %}
                    <td class="border-start border-secondary-subtle {% if team_data.pos == '1' %}bg-warning text-dark fw-bold{% elif team_data.pos == '2' %}bg-secondary text-white{% elif team_data.pos == '3' %}bg-danger text-white{% endif %}" style="text-align: center !important; font-size: 0.75rem;">
                        {{ team_data.pos|default:"-" }}
                    </td>
                    <td style="background: rgba(255,255,255,0.03); text-align: center !important; font-size: 0.75rem;">
                        {{ team_data.pts|default:"0" }}
                    </td>
                    {% endwith %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="table-footer-accent fw-bold border-top border-warning">
                <tr class="text-warning">
                    <td class="border-0 border-end border-secondary"></td> 
                    <td class="pe-2 border-0" style="text-align: right !important; font-size: 0.8rem;">Total Points :</td> 
                    {% for team in teams %}
                    <td class="border-start border-warning-subtle"></td>
                    <td style="text-shadow: 0 0 10px rgba(255,193,7,0.4); text-align: center !important; font-size: 0.85rem;">
                        {% if team_totals.items %}{{ team_totals|get_item:team.code }}{% else %}0{% endif %}
                    </td>
                    {% endfor %}
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="text-center mt-5 opacity-75">
        <p class="text-white small mb-0" style="letter-spacing: 0.5px;">
            Designed & Developed by <span class="text-info fw-bold">Ashish Kamdar</span> 
            <span class="text-white-50 ms-1">(Member- Matunga Gymkhana)</span>
        </p>
    </div>
</div>

<div class="qr-container d-flex align-items-center">
    <div class="text-end me-3">
        <div class="text-white fw-bold" style="font-size: 0.75rem; line-height: 1.2; text-shadow: 2px 2px 4px #000;">
            Scan for live updates<br>on the go
        </div>
    </div>
    <div class="bg-white p-1 rounded shadow-lg" style="width: 80px; height: 80px; border: 2px solid #1e40af;">
        <img id="qrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=72x72&data={{ request.build_absolute_uri }}" 
             alt="Scan for Mobile View" style="width: 72px; height: 72px;">
    </div>
</div>

<style>
    .header-logo { height: 32px; width: auto; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.6)); }
    .team-label { font-size: 0.62rem; color: white; display: inline-block; white-space: normal; line-height: 1; width: 65px; }
    .table-header-glass { background: linear-gradient(180deg, #1e40af 0%, #0f172a 100%) !important; }
    .header-sub-row { background: rgba(0, 0, 0, 0.4); }
    .table-footer-accent { background: #020617 !important; border-top: 2px solid #fbbf24 !important; }
    .championship-row:nth-of-type(even) { background-color: rgba(255, 255, 255, 0.04); }
    .championship-row:nth-of-type(odd) { background-color: rgba(0, 0, 0, 0.18); }
    .qr-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }

    /* Ensure no scrollbar is forced on large screens */
    @media (min-width: 1200px) {
        .custom-table { width: 100%; }
    }
</style>
{% endblock %}