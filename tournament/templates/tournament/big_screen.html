{% load tournament_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MGCL Live Display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
/* TV MODE STYLES - DYNAMIC THEMING */
:root {
    /* DARK MODE (Default) */
    --bg-color: #0f172a;
    --header-bg: #1e3a8a;
    --card-bg: #1e293b;
    --text-main: #ffffff;
    --text-muted: #94a3b8;
    --accent: #3b82f6; 
    --gold: #eab308;
    --green: #22c55e;
    --border: #334155;
    --progress-bg: #1e293b;
}

body.light {
    /* LIGHT MODE */
    --bg-color: #f8fafc;
    --header-bg: #2563eb;
    --card-bg: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --accent: #1d4ed8;
    --gold: #b45309;
    --green: #15803d;
    --border: #e2e8f0;
    --progress-bg: #e2e8f0;
}

body {
    margin: 0;
    padding: 0;
    background-color: var(--bg-color);
    color: var(--text-main);
    font-family: 'Segoe UI', Roboto, sans-serif;
    overflow: hidden; 
    height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.5s ease, color 0.5s ease;
}

/* TOP BAR */
.tv-header {
    background: var(--header-bg);
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    z-index: 100;
    transition: background 0.5s ease;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
}

.event-logo {
    height: 55px;
    width: auto;
    object-fit: contain;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.4));
}

.tv-header h1 { margin: 0; font-size: 32px; text-transform: uppercase; letter-spacing: 2px; color: #ffffff; }

.header-right {
    display: flex;
    align-items: center;
    gap: 30px;
}

.tv-clock { font-size: 24px; font-weight: 700; color: #ffffff; opacity: 0.9; }

/* THEME TOGGLE ICON */
.theme-btn {
    background: transparent;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
}
.theme-btn:hover { transform: scale(1.2) rotate(15deg); }

/* ICON STYLING */
.tv-team-wrapper {
    display: flex;
    align-items: center;
    gap: 15px;
}

.tv-team-icon {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--accent);
    background: rgba(255,255,255,0.05);
}

.tv-icon-placeholder {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    border: 2px dashed var(--text-muted);
}

/* SLIDES CONTAINER */
.content-area {
    flex: 1;
    position: relative;
    padding: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.slide {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    opacity: 0;
    transform: scale(0.98);
    transition: opacity 0.8s ease, transform 0.8s ease;
    padding: 40px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none; 
}

.slide.active {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
    z-index: 10;
}

.slide-title {
    font-size: 42px;
    font-weight: 900;
    color: var(--accent);
    margin-bottom: 40px;
    text-transform: uppercase;
    text-align: center;
    border-bottom: 3px solid var(--border);
    padding-bottom: 10px;
    width: 100%;
}

table { width: 100%; border-collapse: separate; border-spacing: 0 15px; }
th { text-align: left; opacity: 0.6; font-size: 20px; text-transform: uppercase; padding: 0 20px; color: var(--text-main); }
td { background: var(--card-bg); padding: 15px 20px; font-size: 28px; font-weight: 600; border: 1px solid var(--border); vertical-align: middle; color: var(--text-main); transition: background 0.5s ease; }
tr td:first-child { border-radius: 10px 0 0 10px; border-left: 5px solid var(--accent); }
tr td:last-child { border-radius: 0 10px 10px 0; }

.split-view { display: flex; gap: 40px; width: 100%; height: 100%; }
.half { flex: 1; }

.sport-badge { background: var(--border); color: var(--text-muted); font-size: 18px; padding: 5px 12px; border-radius: 6px; text-transform: uppercase; }
.score { color: var(--gold); font-size: 36px; font-weight: 800; font-family: monospace; }
.vs { color: var(--text-muted); margin: 0 15px; font-size: 20px; font-weight: 900; }

.progress-container { height: 8px; background: var(--progress-bg); width: 100%; }
.progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.1s linear; }
</style>
</head>
<body class="dark">

    <div class="tv-header">
        <div class="header-left">
            {% with first_m=upcoming.0|default:recent.0 %}
                {% if first_m.event.logo %}
                    <img src="{{ first_m.event.logo.url }}" class="event-logo" alt="Event Logo">
                {% endif %}
            {% endwith %}
            <h1>MGCL Live Center</h1>
        </div>
        <div class="header-right">
            <button class="theme-btn" onclick="toggleTheme()" id="theme-icon">üåó</button>
            <a href="{% url 'logout' %}" style="text-decoration: none; font-size: 24px; margin-right: 10px;" title="Logout">üö™</a>
            <div class="tv-clock" id="clock">{% now "H:i" %}</div>
        </div>
    </div>

    <div class="content-area">

        <div class="slide active" id="slide-1">
            <div class="slide-title">Championship Standings</div>
            <div class="split-view">
                <div class="half">
                    <h2 style="text-align:center; color: var(--text-muted);">GROUP A</h2>
                    <table>
                        <thead><tr><th>Rk</th><th>Team</th><th style="text-align:right;">Pts</th></tr></thead>
                        <tbody>
                            {% for s in standings_a %}
                            <tr>
                                <td style="width:60px; text-align:center;">{{ forloop.counter }}</td>
                                <td>
                                    <div class="tv-team-wrapper">
                                        {% if s.team.icon %}
                                            <img src="{{ s.team.icon.url }}" class="tv-team-icon">
                                        {% else %}
                                            <div class="tv-icon-placeholder">üõ°Ô∏è</div>
                                        {% endif %}
                                        <span>{{ s.team.name }}</span>
                                    </div>
                                </td>
                                <td style="text-align:right; color:var(--gold);">{{ s.total_points }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="half">
                    <h2 style="text-align:center; color: var(--text-muted);">GROUP B</h2>
                    <table>
                        <thead><tr><th>Rk</th><th>Team</th><th style="text-align:right;">Pts</th></tr></thead>
                        <tbody>
                            {% for s in standings_b %}
                            <tr>
                                <td style="width:60px; text-align:center;">{{ forloop.counter }}</td>
                                <td>
                                    <div class="tv-team-wrapper">
                                        {% if s.team.icon %}
                                            <img src="{{ s.team.icon.url }}" class="tv-team-icon">
                                        {% else %}
                                            <div class="tv-icon-placeholder">üõ°Ô∏è</div>
                                        {% endif %}
                                        <span>{{ s.team.name }}</span>
                                    </div>
                                </td>
                                <td style="text-align:right; color:var(--gold);">{{ s.total_points }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="slide" id="slide-2">
            <div class="slide-title">Coming Up Next</div>
            {% if upcoming %}
            <table style="width: 90%;">
                <thead><tr><th>Time</th><th>Sport</th><th>Matchup</th></tr></thead>
                <tbody>
                    {% for m in upcoming %}
                    <tr>
                        <td style="white-space: nowrap;">
                            <span style="color: var(--gold); font-weight:700; margin-right:12px; font-size:26px;">
                                {{ m.date|date:"M j" }}
                            </span>
                            <span style="color:var(--accent); font-weight:900; font-size:32px;">
                                {{ m.time|time:"H:i" }}
                            </span>
                        </td>
                        <td style="width:200px;"><span class="sport-badge">{{ m.event.sport.name }}</span></td>
                        <td>
                            <div class="tv-team-wrapper">
                                {% if m.team1 %}
                                    {% if m.team1.icon %}<img src="{{ m.team1.icon.url }}" class="tv-team-icon">{% endif %}
                                    <span>{{ m.team1.name }}</span>
                                {% else %}
                                    <span style="opacity:0.5;">{{ m.opponent_rule }}</span>
                                {% endif %}
                                <span class="vs">VS</span>
                                {% if m.team2 %}
                                    {% if m.team2.icon %}<img src="{{ m.team2.icon.url }}" class="tv-team-icon">{% endif %}
                                    <span>{{ m.team2.name }}</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <div class="slide" id="slide-3">
            <div class="slide-title">Latest Results</div>
            {% if recent %}
            <table style="width: 95%;">
                <thead><tr><th>Sport</th><th>Match</th><th style="text-align:right;">Result</th></tr></thead>
                <tbody>
                    {% for m in recent %}
                    <tr>
                        <td style="width:200px;"><span class="sport-badge">{{ m.event.sport.name }}</span></td>
                        <td>
                            <div class="tv-team-wrapper">
                                {% if m.team1.icon %}<img src="{{ m.team1.icon.url }}" class="tv-team-icon">{% endif %}
                                <span>{{ m.team1.name }}</span>
                                <span class="vs">vs</span>
                                <span>{{ m.team2.name }}</span>
                                {% if m.team2.icon %}<img src="{{ m.team2.icon.url }}" class="tv-team-icon">{% endif %}
                            </div>
                        </td>
                        <td style="text-align:right;">
                            <span class="score">{{ m.team1_score }} - {{ m.team2_score }}</span>
                            <div style="font-size:16px; color:var(--green); font-weight:900;">üèÜ {{ m.winner }}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-bar" id="progress"></div>
    </div>

<script>
    // CONFIG
    const slideDuration = 10000;
    const refreshInterval = 120000;

    let slides = document.querySelectorAll('.slide');
    let currentSlide = 0;
    let progressBar = document.getElementById('progress');
    let progress = 0;

    // THEME TOGGLE LOGIC
    function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById('theme-icon');
        
        if (body.classList.contains('dark')) {
            body.classList.replace('dark', 'light');
            localStorage.setItem("mgcl-tv-theme", "light");
            icon.innerText = "‚òÄÔ∏è";
        } else {
            body.classList.replace('light', 'dark');
            localStorage.setItem("mgcl-tv-theme", "dark");
            icon.innerText = "üåó";
        }
    }

    // CLOCK
    setInterval(() => {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }, 1000);

    // SLIDE ROTATOR
    setInterval(() => {
        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + 1) % slides.length;
        slides[currentSlide].classList.add('active');
        progress = 0;
    }, slideDuration);

    // PROGRESS BAR
    setInterval(() => {
        progress += 100 / (slideDuration / 100); 
        if (progress > 100) progress = 0;
        progressBar.style.width = progress + "%";
    }, 100);

    // INIT
    window.onload = () => {
        const savedTheme = localStorage.getItem("mgcl-tv-theme");
        const icon = document.getElementById('theme-icon');
        if (savedTheme === "light") {
            document.body.classList.replace('dark', 'light');
            icon.innerText = "‚òÄÔ∏è";
        }
    };

    // AUTO REFRESH
    setTimeout(() => {
        location.reload();
    }, refreshInterval);
</script>

</body>
</html>